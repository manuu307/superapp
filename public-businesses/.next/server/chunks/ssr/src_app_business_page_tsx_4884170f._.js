module.exports=[17032,a=>{"use strict";var b=a.i(87924),c=a.i(42018),d=a.i(72131);let e=({businessId:a})=>{let[c,e]=(0,d.useState)([]),[f,g]=(0,d.useState)(null),[h,i]=(0,d.useState)(null),[j,k]=(0,d.useState)(!0),[l,m]=(0,d.useState)(null);(0,d.useEffect)(()=>{let b=async()=>{try{let b=localStorage.getItem("token"),c=await fetch(`/api/products/${a}`,{headers:{"x-auth-token":b||""}});if(!c.ok)throw Error("Failed to fetch products");let d=await c.json();e(d)}catch(a){m(a.message)}finally{k(!1)}};a&&b()},[a]);let n=async a=>{if(window.confirm("Are you sure you want to delete this product?")){let b=localStorage.getItem("token");if(b)try{if(!(await fetch(`/api/products/${a}`,{method:"DELETE",headers:{"x-auth-token":b}})).ok)throw Error("Failed to delete product");e(c.filter(b=>b._id!==a)),g(null)}catch(a){console.error("Error deleting product:",a)}}},o=async(a,b)=>{a.preventDefault();let d=localStorage.getItem("token");if(!d)return;let f=new FormData(a.currentTarget),g=f.get("name"),h=f.get("short_description"),j=f.get("description"),k=parseFloat(f.get("price_before")),l=parseFloat(f.get("price_after")),m=a.currentTarget.elements.namedItem("picture").files?.[0],n=b.picture;if(m){let a=new FormData;a.append("file",m);try{let b=await fetch("/api/files/upload",{method:"POST",headers:{"x-auth-token":d},body:a});if(!b.ok)throw Error("File upload failed");let{url:c}=await b.json();n=c}catch(a){console.error(a);return}}let o={name:g,short_description:h,description:j,price_before:k,price_after:l,picture:n};try{let a=await fetch(`/api/products/${b._id}`,{method:"PUT",headers:{"Content-Type":"application/json","x-auth-token":d},body:JSON.stringify(o)});if(!a.ok)throw Error("Failed to update product");let f=await a.json();e(c.map(a=>a._id===b._id?f:a)),i(null)}catch(a){console.error("Error updating product:",a)}};return j?(0,b.jsx)("div",{children:"Loading catalog..."}):l?(0,b.jsxs)("div",{children:["Error: ",l]}):0===c.length?(0,b.jsx)("div",{children:"No products in catalog."}):(0,b.jsxs)("div",{className:"p-4 space-y-4 bg-white rounded-lg shadow-md dark:bg-gray-800",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold",children:"Business Catalog"}),(0,b.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:c.map(a=>(0,b.jsxs)("div",{onClick:()=>{g(a)},className:"p-4 space-y-2 bg-gray-200 rounded-lg shadow-md cursor-pointer dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600",children:[(0,b.jsx)("h4",{className:"text-lg font-bold",children:a.name}),(0,b.jsx)("img",{src:a.picture,alt:a.name,className:"w-full rounded-md"}),(0,b.jsx)("p",{children:a.short_description}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-sm text-gray-500 line-through",children:["$",a.price_before]}),(0,b.jsxs)("span",{className:"text-lg font-bold text-green-600",children:["$",a.price_after]})]})]},a._id))}),f&&(0,b.jsx)("div",{className:"fixed top-0 left-0 flex items-center justify-center w-full h-full bg-black bg-opacity-80",onClick:()=>{g(null)},children:(0,b.jsxs)("div",{className:"p-8 m-4 space-y-4 overflow-auto bg-white rounded-lg shadow-md max-w-3xl max-h-3/4 dark:bg-gray-800",children:[(0,b.jsx)("h2",{className:"text-3xl font-bold",children:f.name}),(0,b.jsx)("img",{src:f.picture,alt:f.name,className:"w-full rounded-md"}),(0,b.jsx)("p",{className:"text-lg",children:f.short_description}),(0,b.jsx)("p",{children:f.description}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-lg text-gray-500 line-through",children:["$",f.price_before]}),(0,b.jsxs)("span",{className:"text-2xl font-bold text-green-600",children:["$",f.price_after]})]}),(0,b.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,b.jsx)("button",{onClick:a=>{a.stopPropagation(),g(null),i(f)},className:"px-4 py-2 font-bold text-white bg-blue-500 rounded-md hover:bg-blue-700",children:"Edit"}),(0,b.jsx)("button",{onClick:a=>{a.stopPropagation(),n(f._id)},className:"px-4 py-2 font-bold text-white bg-red-500 rounded-md hover:bg-red-700",children:"Delete"})]})]})}),h&&(0,b.jsx)("div",{className:"fixed top-0 left-0 flex items-center justify-center w-full h-full bg-black bg-opacity-80",children:(0,b.jsxs)("div",{className:"p-8 m-4 space-y-4 overflow-auto bg-white rounded-lg shadow-md max-w-3xl max-h-3/4 dark:bg-gray-800",children:[(0,b.jsx)("h2",{className:"text-3xl font-bold",children:"Edit Product"}),(0,b.jsxs)("form",{onSubmit:a=>o(a,h),className:"space-y-4",children:[(0,b.jsx)("input",{type:"text",name:"name",defaultValue:h.name,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsx)("input",{type:"text",name:"short_description",defaultValue:h.short_description,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsx)("textarea",{name:"description",defaultValue:h.description,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsx)("input",{type:"number",name:"price_before",defaultValue:h.price_before,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsx)("input",{type:"number",name:"price_after",defaultValue:h.price_after,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsx)("input",{type:"file",name:"picture",className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsxs)("div",{className:"flex space-x-4",children:[(0,b.jsx)("button",{type:"submit",className:"w-full px-4 py-2 font-bold text-white bg-blue-500 rounded-md hover:bg-blue-700",children:"Save"}),(0,b.jsx)("button",{type:"button",onClick:()=>i(null),className:"w-full px-4 py-2 font-bold text-white bg-gray-500 rounded-md hover:bg-gray-700",children:"Cancel"})]})]})]})})]})},f=({businessId:a})=>{let[c,e]=(0,d.useState)([]),[f,g]=(0,d.useState)(""),[h,i]=(0,d.useState)(""),[j,k]=(0,d.useState)(""),[l,m]=(0,d.useState)(null),[n,o]=(0,d.useState)(""),[p,q]=(0,d.useState)(""),[r,s]=(0,d.useState)(""),[t,u]=(0,d.useState)(null),v=(0,d.useCallback)(async()=>{try{let b=await fetch(`/api/products/${a}`);if(!b.ok)throw Error("Failed to fetch products");let c=await b.json();e(c)}catch(a){console.error(a),s(a.message||"Failed to fetch products.")}},[a]);(0,d.useEffect)(()=>{a&&v()},[a,v]);let w=a=>{a.target.files&&a.target.files.length>0&&m(a.target.files[0])},x=async a=>{if(window.confirm("Are you sure you want to delete this product?")){let b=localStorage.getItem("token");if(!b)return void s("Authentication token not found. Please log in.");try{if(!(await fetch(`/api/products/${a}`,{method:"DELETE",headers:{"x-auth-token":b}})).ok)throw Error("Failed to delete product");e(c.filter(b=>b._id!==a))}catch(a){console.error("Error deleting product:",a),s(a.message||"Failed to delete product.")}}},y=async a=>{if(a.preventDefault(),!t)return;let b=localStorage.getItem("token");if(!b)return void s("Authentication token not found. Please log in.");let d=t.picture;if(l){let a=new FormData;a.append("file",l);try{let c=await fetch("/api/files/upload",{method:"POST",headers:{"x-auth-token":b},body:a});if(!c.ok)throw Error("File upload failed");let{url:e}=await c.json();d=e}catch(a){console.error(a),s("File upload failed.");return}}try{let a=await fetch(`/api/products/${t._id}`,{method:"PUT",headers:{"Content-Type":"application/json","x-auth-token":b},body:JSON.stringify({name:f,short_description:h,description:j,picture:d,price_before:parseFloat(n),price_after:parseFloat(p)})});if(!a.ok){let b=await a.json();throw Error(b.message||"Failed to update product")}let l=await a.json();e(c.map(a=>a._id===t._id?l:a)),u(null),g(""),i(""),k(""),o(""),q(""),m(null)}catch(a){console.error(a),s(a.message||"Failed to update product.")}},z=async b=>{if(b.preventDefault(),s(""),!f||!h||!j||!l||!n||!p)return void s("Please fill in all required fields.");let c=localStorage.getItem("token");if(!c)return void s("Authentication token not found. Please log in.");let d="";if(l){let a=new FormData;a.append("file",l);try{let b=await fetch("/api/files/upload",{method:"POST",headers:{"x-auth-token":c},body:a});if(!b.ok)throw Error("File upload failed");let{url:e}=await b.json();d=e}catch(a){console.error(a),s(a.message||"File upload failed. Please try again.");return}}try{let b=await fetch("/api/products",{method:"POST",headers:{"Content-Type":"application/json","x-auth-token":c},body:JSON.stringify({name:f,short_description:h,description:j,picture:d,price_before:parseFloat(n),price_after:parseFloat(p),businessId:a})});if(!b.ok){let a=await b.json();throw Error(a.message||"Failed to create product.")}g(""),i(""),k(""),m(null),o(""),q(""),v()}catch(a){console.error(a),s(a.message||"An error occurred while creating the product.")}};return t?(0,b.jsxs)("div",{className:"p-4 space-y-4 bg-white rounded-lg shadow-md dark:bg-gray-800",children:[(0,b.jsx)("h3",{className:"text-xl font-bold",children:"Edit Product"}),(0,b.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[r&&(0,b.jsx)("p",{className:"text-red-500 text-center",children:r}),(0,b.jsx)("input",{type:"text",placeholder:"Name",value:f,onChange:a=>g(a.target.value),required:!0,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsx)("input",{type:"text",placeholder:"Short Description",value:h,onChange:a=>i(a.target.value),required:!0,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsx)("input",{type:"text",placeholder:"Description",value:j,onChange:a=>k(a.target.value),required:!0,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsx)("input",{type:"file",onChange:w,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsx)("input",{type:"number",placeholder:"Price Before",value:n,onChange:a=>o(a.target.value),required:!0,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsx)("input",{type:"number",placeholder:"Price After",value:p,onChange:a=>q(a.target.value),required:!0,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsxs)("div",{className:"flex space-x-4",children:[(0,b.jsx)("button",{type:"submit",className:"w-full px-4 py-2 font-bold text-white bg-blue-500 rounded-md hover:bg-blue-700",children:"Save"}),(0,b.jsx)("button",{type:"button",onClick:()=>u(null),className:"w-full px-4 py-2 font-bold text-white bg-gray-500 rounded-md hover:bg-gray-700",children:"Cancel"})]})]})]}):(0,b.jsxs)("div",{className:"p-4 space-y-4 bg-white rounded-lg shadow-md dark:bg-gray-800",children:[(0,b.jsx)("h3",{className:"text-xl font-bold",children:"Create Product"}),(0,b.jsxs)("form",{onSubmit:z,className:"space-y-4",children:[r&&(0,b.jsx)("p",{className:"text-red-500 text-center",children:r}),(0,b.jsx)("input",{type:"text",placeholder:"Name",value:f,onChange:a=>g(a.target.value),required:!0,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsx)("input",{type:"text",placeholder:"Short Description",value:h,onChange:a=>i(a.target.value),required:!0,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsx)("input",{type:"text",placeholder:"Description",value:j,onChange:a=>k(a.target.value),required:!0,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsx)("input",{type:"file",onChange:w,required:!0,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsx)("input",{type:"number",placeholder:"Price Before",value:n,onChange:a=>o(a.target.value),required:!0,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsx)("input",{type:"number",placeholder:"Price After",value:p,onChange:a=>q(a.target.value),required:!0,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsx)("button",{type:"submit",className:"w-full px-4 py-2 font-bold text-white bg-blue-500 rounded-md hover:bg-blue-700",children:"Create Product"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-xl font-bold",children:"Products"}),(0,b.jsx)("ul",{className:"space-y-2",children:c.map(a=>(0,b.jsxs)("li",{className:"flex items-center justify-between p-2 space-x-4 bg-gray-200 rounded-md dark:bg-gray-700",children:[(0,b.jsxs)("div",{className:"flex items-center flex-grow space-x-4",children:[(0,b.jsx)("img",{src:a.picture||"https://via.placeholder.com/50",alt:a.name,className:"w-12 h-12 rounded-full"}),(0,b.jsx)("span",{children:a.name})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("button",{onClick:()=>{u(a),g(a.name),i(a.short_description),k(a.description),o(a.price_before.toString()),q(a.price_after.toString()),m(null)},className:"px-3 py-1 mr-2 text-white bg-blue-500 rounded-md hover:bg-blue-700",children:"Edit"}),(0,b.jsx)("button",{onClick:()=>x(a._id),className:"px-3 py-1 text-white bg-red-500 rounded-md hover:bg-red-700",children:"Delete"})]})]},a._id))})]})]})},g=()=>{let[a,c]=(0,d.useState)([]),[g,h]=(0,d.useState)(""),[i,j]=(0,d.useState)(null),[k,l]=(0,d.useState)(null),[m,n]=(0,d.useState)(null),o=(0,d.useCallback)(async()=>{let a=localStorage.getItem("token");if(a)try{let b=await fetch("/api/business",{headers:{"x-auth-token":a}});if(!b.ok)throw Error("Failed to fetch businesses");let d=await b.json();c(d)}catch(a){console.error("Error fetching businesses:",a)}},[]);(0,d.useEffect)(()=>{o()},[o]);let p=a=>{a.target.files&&a.target.files.length>0&&j(a.target.files[0])},q=async a=>{a.preventDefault();let b=localStorage.getItem("token");if(!b)return;let c="";if(i){let a=new FormData;a.append("file",i);try{let d=await fetch("/api/files/upload",{method:"POST",headers:{"x-auth-token":b},body:a});if(!d.ok)throw Error("File upload failed");let{url:e}=await d.json();c=e}catch(a){console.error(a);return}}try{let a=await fetch("/api/business",{method:"POST",headers:{"Content-Type":"application/json","x-auth-token":b},body:JSON.stringify({name:g,picture:c})});if(!a.ok){let b=await a.json();throw Error(b.message||"Failed to create business")}h(""),j(null),o()}catch(a){console.error(a)}},r=async b=>{if(b.preventDefault(),!m)return;let d=localStorage.getItem("token");if(!d)return;let e=m.picture;if(i){let a=new FormData;a.append("file",i);try{let b=await fetch("/api/files/upload",{method:"POST",headers:{"x-auth-token":d},body:a});if(!b.ok)throw Error("File upload failed");let{url:c}=await b.json();e=c}catch(a){console.error(a);return}}try{let b=await fetch(`/api/business/${m._id}`,{method:"PUT",headers:{"Content-Type":"application/json","x-auth-token":d},body:JSON.stringify({name:g,picture:e})});if(!b.ok){let a=await b.json();throw Error(a.message||"Failed to update business")}let f=await b.json();c(a.map(a=>a._id===m._id?f:a)),n(null),h(""),j(null)}catch(a){console.error(a)}},s=async b=>{if(window.confirm("Are you sure you want to delete this business?")){let d=localStorage.getItem("token");if(d)try{if(!(await fetch(`/api/business/${b}`,{method:"DELETE",headers:{"x-auth-token":d}})).ok)throw Error("Failed to delete business");c(a.filter(a=>a._id!==b))}catch(a){console.error("Error deleting business:",a)}}};return m?(0,b.jsxs)("div",{className:"p-4 space-y-4 bg-white rounded-lg shadow-md dark:bg-gray-800",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold",children:"Edit Business"}),(0,b.jsxs)("form",{onSubmit:r,className:"space-y-4",children:[(0,b.jsx)("input",{type:"text",placeholder:"Business Name",value:g,onChange:a=>h(a.target.value),required:!0,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block mb-2 text-sm font-bold text-gray-700 dark:text-gray-300",htmlFor:"business-picture",children:"Business Picture"}),(0,b.jsx)("input",{id:"business-picture",type:"file",onChange:p,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"})]}),(0,b.jsxs)("div",{className:"flex space-x-4",children:[(0,b.jsx)("button",{type:"submit",className:"w-full px-4 py-2 font-bold text-white bg-blue-500 rounded-md hover:bg-blue-700",children:"Save"}),(0,b.jsx)("button",{type:"button",onClick:()=>n(null),className:"w-full px-4 py-2 font-bold text-white bg-gray-500 rounded-md hover:bg-gray-700",children:"Cancel"})]})]})]}):k?(0,b.jsxs)("div",{className:"p-4 space-y-4 bg-white rounded-lg shadow-md dark:bg-gray-800",children:[(0,b.jsx)("button",{onClick:()=>l(null),className:"px-4 py-2 font-bold text-white bg-blue-500 rounded-md hover:bg-blue-700",children:"Back to Businesses"}),(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("img",{src:k.picture||"https://via.placeholder.com/150",alt:k.name,className:"w-24 h-24 rounded-full"}),(0,b.jsx)("h2",{className:"text-2xl font-bold",children:k.name})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,b.jsx)(f,{businessId:k._id}),(0,b.jsx)(e,{businessId:k._id})]})]}):(0,b.jsxs)("div",{className:"p-4 space-y-4 bg-white rounded-lg shadow-md dark:bg-gray-800",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold",children:"My Businesses"}),(0,b.jsxs)("form",{onSubmit:q,className:"space-y-4",children:[(0,b.jsx)("input",{type:"text",placeholder:"Business Name",value:g,onChange:a=>h(a.target.value),required:!0,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block mb-2 text-sm font-bold text-gray-700 dark:text-gray-300",htmlFor:"business-picture",children:"Business Picture"}),(0,b.jsx)("input",{id:"business-picture",type:"file",onChange:p,className:"w-full px-4 py-2 bg-gray-200 border border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700"})]}),(0,b.jsx)("button",{type:"submit",className:"w-full px-4 py-2 font-bold text-white bg-blue-500 rounded-md hover:bg-blue-700",children:"Create Business"})]}),(0,b.jsx)("ul",{className:"space-y-2",children:a.map(a=>(0,b.jsxs)("li",{className:"flex items-center justify-between p-2 space-x-4 bg-gray-200 rounded-md dark:bg-gray-700",children:[(0,b.jsxs)("div",{onClick:()=>l(a),className:"flex items-center flex-grow space-x-4 cursor-pointer",children:[(0,b.jsx)("img",{src:a.picture||"https://via.placeholder.com/50",alt:a.name,className:"w-12 h-12 rounded-full"}),(0,b.jsx)("span",{children:a.name})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),n(a),h(a.name),j(null)},className:"px-3 py-1 mr-2 text-white bg-blue-500 rounded-md hover:bg-blue-700",children:"Edit"}),(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),s(a._id)},className:"px-3 py-1 text-white bg-red-500 rounded-md hover:bg-red-700",children:"Delete"})]})]},a._id))})]})},h=(0,a.i(80148).withProtectedRoute)(()=>(0,b.jsx)(c.BusinessProvider,{children:(0,b.jsx)(g,{})}));a.s(["default",0,h],17032)}];

//# sourceMappingURL=src_app_business_page_tsx_4884170f._.js.map